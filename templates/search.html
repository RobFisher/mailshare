{% load dajaxice_templatetags %}

<html>
<head>
<title>Mailshare Search</title>
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}mailshare.css" />
<script src="{{ STATIC_URL }}jquery.js"></script>
{% dajaxice_js_import %}
<script src="{{ STATIC_URL }}jquery.dajax.core.js" type="text/javascript" charset="utf-8"></script>

<script>
function get_email_body_element(email_id) {
    element_selector = "#body_" + email_id;
    return $(element_selector)
}

function toggle_email_body(email_id) {
    element = get_email_body_element(email_id);
    c = element.attr("class");
    if(c == "empty") {
        element.attr("class", "showing");
        fetch_email(email_id, $(element));
    }
    else if(c == "shown") {
        element.attr("class", "hidden");
    }
    else if(c == "hidden") {
        element.attr("class", "shown");
    }
}

function fetch_email(email_id) {
    Dajaxice.mailshare.mailshareapp.expand_email(Dajax.process,{'email_id':email_id})
}

function set_email_body(data) {
    element = get_email_body_element(data.email_id);
    element.html(data.email_body)
    element.attr("class", "shown")
}
</script>

</head>
<body>
<h1>Mailshare Search</h1>
<form action="/search/" name="search" method="GET">
<input id="query" name="query" value="{{ search_query }}" />
<input id="submit" type="submit" value="Search" />
</form>    
{% if results %}
    <table border="1">
    {% for result in results %}
        <tr onclick="toggle_email_body({{ result.id }})">
            <td>{{ result.date }}</td>
            <td>{{ result.sender }}</td>
            <td>{{ result.subject }}</td>
        </tr>
	<tr>
	  <td colspan="3" class="empty" id="body_{{ result.id }}">Email body</td>
	</tr>
    {% endfor %}
    </table>
{% else %}
    <p>No results found.</p>
{% endif %}
</form>    
</body>
</html>
